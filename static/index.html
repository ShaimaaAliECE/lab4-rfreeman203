<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
</head>
<body>
    <h1>
        Welcome to the SE3316 Quiz!
    </h1>
    <button id='quiz-btn'>START</button>
    <div id='questionDiv'></div>
</body>
<script>
    let quizBtn = document.getElementById('quiz-btn');
    quizBtn.onclick = loadQuestions;

    function loadQuestions()
    {
        quizBtn.remove();

        let xReq = new XMLHttpRequest();
        xReq.onreadystatechange = displayQuestions;
        
        xReq.open('GET', '/questionsInJson',true);
        xReq.send();
    }

    function displayQuestions()
    {
        if(this.readyState == 4 && this.status == 200)
        {
            let questionDiv = document.getElementById('questionDiv');
            let questionList = JSON.parse(this.responseText);
            let content = "";

            content += '<form action=javascript:loadAnswers()>';

            for(q of questionList)
            {
                content += '<p>' + q.stem + '</p>';
                
                for(n of q.options)
                {
                    content += '<input type="radio" id="answer ' + n + '" name="' + q.stem + '">';
                    content += '<label for="answer ' + n + '">' + n + '</label></br>';
                }

                content += '</br><div id=\'answerDiv ' + q.stem + '\'></div>';

            }

            content += '</br><input type="submit" value="Submit">'
            content += '</form></br>';


            questionDiv.innerHTML = content;
        }
    }

    function loadAnswers()
    {
        let xReq = new XMLHttpRequest();
        xReq.onreadystatechange = displayAnswers;
        
        xReq.open('GET', '/questionsInJson',true);
        xReq.send();
    }

    function  displayAnswers()
    {
        if(this.readyState == 4 && this.status == 200)
        {
            let questionList = JSON.parse(this.responseText);

            for(q of questionList)
            {
                let feedback = '';
                let answerDiv = document.getElementById('answerDiv ' + q.stem);
                feedback += q.answerIndex;
                answerDiv.innerHTML = feedback;
            }
        }
    }

</script>
</html>