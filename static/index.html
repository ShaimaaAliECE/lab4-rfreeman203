<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
</head>
<body>
    <h1>
        Welcome to the SE3316 Quiz!
    </h1>
    <button id='quiz-btn'>START</button>
    <div id='questionDiv'></div>
</body>
<script>
    let quizBtn = document.getElementById('quiz-btn');
    quizBtn.onclick = loadQuestions;

    function loadQuestions()
    {
        quizBtn.remove();

        let xReq = new XMLHttpRequest();
        xReq.onreadystatechange = displayQuestions;
        
        xReq.open('GET', '/questionsInJson',true);
        xReq.send();
    }

    function displayQuestions()
    {
        if(this.readyState == 4 && this.status == 200)
        {
            let questionDiv = document.getElementById('questionDiv');
            let questionList = JSON.parse(this.responseText);
            let content = "";

            content += '<form action=javascript:loadAnswers()>';

            for(q of questionList)
            {
                content += '<p>' + q.stem + '</p>';
                
                for(n of q.options)
                {
                    content += '<input type="radio" id="answer ' + n + '" name="' + q.stem + '">';
                    content += '<label for="answer ' + n + '">' + n + '</label></br>';
                }

                content += '</br><div id=\'answerDiv ' + q.stem + '\'></div>';

            }

            content += '</br><input type="submit" value="Submit" id="submit-btn">';
            content += '</form></br>';

            content += '<div id=\'gradeDiv\'></div></br>';

            questionDiv.innerHTML = content;
        }
    }

    function loadAnswers()
    {
        let submitBtn = document.getElementById('submit-btn');
        submitBtn.remove();

        let xReq = new XMLHttpRequest();
        xReq.onreadystatechange = displayAnswers;
        
        xReq.open('GET', '/questionsInJson',true);
        xReq.send();
    }

    function  displayAnswers()
    {
        if(this.readyState == 4 && this.status == 200)
        {
            let questionList = JSON.parse(this.responseText);
            let gradeDiv = document.getElementById('gradeDiv');
            let correctAnswers = 0;
            let totalQuestions = 0;

            for(q of questionList)
            {
                let feedback = '';
                let answerDiv = document.getElementById('answerDiv ' + q.stem);

                let radioButtons = document.getElementsByName("" + q.stem);

                for(let i = 0; i < radioButtons.length; i++)
                {
                    if(radioButtons[i].checked == true)
                    {
                        if(i == q.answerIndex){
                            feedback = "Correct!";
                            correctAnswers++;
                        }
                        else
                        {
                            feedback = "Incorrect! ";
                        }
                    }
                }
                
                answerDiv.innerHTML = feedback;
                totalQuestions ++;
            }

            gradeDiv.innerHTML = "Your grade is: " + correctAnswers / totalQuestions * 100 + "%!";
        }
    }

</script>
</html>